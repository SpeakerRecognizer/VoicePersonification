# Система экзаменов с голосовой идентификацией

Демонстрационное приложение для проведения экзаменов с использованием голосовой идентификации и распознавания речи. Система позволяет регистрировать пользователей по голосу, генерировать экзаменационные вопросы, принимать голосовые ответы и автоматически проверять их.

## Описание

Система состоит из трех основных компонентов:

1. **Регистрация и идентификация пользователей** - регистрация новых пользователей и вход существующих через голосовую идентификацию
2. **Прохождение экзамена** - генерация вопросов, запись голосовых ответов, распознавание речи и автоматическая проверка ответов
3. **Анализ результатов** - статистика по экзаменам, визуализация результатов и персональные рекомендации

## Установка
Пропиши необходимые точки входа в .env

### Требования

- Python 3.8+
- Доступ к сервисам:
  - VAD (Voice Activity Detection)
  - ASR (Automatic Speech Recognition) - Whisper
  - Speaker Recognition (ITMO Large)
  - LLM сервис для генерации вопросов и проверки ответов

### Установка зависимостей

```bash
pip install -r requirements.txt
```

Также необходимо установить зависимости из корня проекта для работы с сервисами (multi_service_client и protobuf модули).

## Настройка

Создайте файл `.env` в директории `demo/examination/` со следующими переменными:

```env
# Настройки сервисов
GRPC_HOST=
VAD_SERVICE_PORT=
PERSONIFICATION_SERVICE_PORT=
ASR_SERVICE_PORT=50051

# Настройки LLM для генерации вопросов и проверки ответов
LLM_BASE_URL=
LLM_API_KEY=
LLM_MODEL_PATH=
LLM_TEMPERATURE=

# Файл с темами экзамена
TOPIC_FILE=exam_topics.json

# Пороги для идентификации и верификации
IDENTIFICATION_THRESHOLD=0.7
VERIFICATION_THRESHOLD=0.5
```

## Использование

### Запуск приложения

```bash
python app.py
```

Приложение запустится на локальном сервере Gradio (обычно `http://127.0.0.1:7860`).

### Работа с системой

1. **Регистрация/Вход**:
   - Перейдите на вкладку "Регистрация"
   - Запишите аудио с помощью микрофона
   - Нажмите "Обработать аудио"
   - Если пользователь найден - подтвердите вход, если нет - зарегистрируйтесь с указанием имени

2. **Прохождение экзамена**:
   - Перейдите на вкладку "Экзамен"
   - Нажмите "Сгенерировать экзамен"
   - Для каждого вопроса:
     - Запишите голосовой ответ
     - Нажмите "Распознать" для преобразования речи в текст
     - Проверьте распознанный текст и нажмите "Отправить на проверку"
     - При необходимости посмотрите объяснение правильного ответа
   - Переходите между вопросами с помощью кнопок "Предыдущий вопрос" / "Следующий вопрос"

3. **Анализ результатов**:
   - Перейдите на вкладку "Анализ"
   - Просмотрите статистику по всем экзаменам
   - Изучите графики распределения оценок
   - Получите персональные рекомендации для улучшения результатов

## Структура файлов

- `app.py` - основной файл приложения с интерфейсом Gradio
- `utils_services.py` - утилиты для работы с сервисами (идентификация, верификация, ASR)
- `utils_examinator.py` - утилиты для работы с экзаменами (генерация вопросов, проверка ответов, анализ результатов)
- `exam_topics.json` - файл с темами для экзаменационных вопросов
- `question_bank.json` - банк сгенерированных вопросов (создается автоматически)
- `exams_database.json` - база данных с результатами экзаменов
- `users_database.json` - база данных с зарегистрированными пользователями
- `multi_service_metadata.db` - SQLite база данных с метаданными для идентификации дикторов
- `requirements.txt` - зависимости Python

## Функциональность

### Генерация вопросов

Вопросы генерируются автоматически с помощью LLM на основе тем из файла `exam_topics.json`. Каждый экзамен содержит 3 случайных вопроса из банка.

### Проверка ответов

Ответы проверяются автоматически с помощью LLM, который сравнивает ответ пользователя с эталонным ответом. Результат проверки:
- `True` - ответ принят (правильный)
- `False` - ответ отклонен (неправильный)

### Оценка экзамена

Оценка выставляется по 5-балльной шкале на основе количества принятых вопросов:
- 3 принятых вопроса - оценка 5
- 2 принятых вопроса - оценка 4
- 1 принятый вопрос - оценка 3
- 0 принятых вопросов - оценка 2

### Анализ результатов

Система анализирует все экзамены пользователя и предоставляет:
- Общее количество экзаменов
- Среднюю оценку
- Процент успешных ответов
- Распределение оценок
- Персональные рекомендации для улучшения

## Константы

В файле `app.py` можно настроить следующие константы:

- `IDENTIFICATION_THRESHOLD` (0.7) - порог для идентификации диктора
- `VERIFICATION_THRESHOLD` (0.5) - порог для верификации диктора
- `EXAM_QUESTIONS_COUNT` (3) - количество вопросов в экзамене

## Примечания

- Для работы системы необходим доступ к сервисам через gRPC
- База данных метаданных создается автоматически при первом использовании
- Все аудио файлы обрабатываются временно и не сохраняются на диск
- Результаты экзаменов сохраняются в JSON формате для последующего анализа

